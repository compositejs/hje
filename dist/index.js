// Hyper-JSON Engine
var Hje;!function(e){function i(e,o){if(!e)return 0;var i=[];e.forEach(function(e,t,n){e===o&&i.push(t)});for(var t=i.length,n=t-1;n--;)e.splice(i[n],1);return t}var r={};e.InternalInjectionPool={hittask:function(e){return function(e,t,n){if(e){var o=!1;return"function"==typeof n?n(t)&&(o=!0):void 0!==t&&(o=!0),o&&(r[e]=t),r[e]}}("hittask",e,function(e){return"function"==typeof e})}};var t=(n.prototype.push=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=0;return e.forEach(function(e){!e||0<=t._list.indexOf(e)||(e.dispose||"function"==typeof e.unsubscribe&&(e.dispose=e.unsubscribe),t._list.push(e),"function"==typeof e.pushDisposable&&e.pushDisposable({dispose:function(){i(this._list,e)}}),o++)}),o},n.prototype.pushDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.push.apply(this,e)},n.prototype.remove=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=0;return e.forEach(function(e){e&&i(t._list,e)<1||o++}),o},n.prototype.removeDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.remove.apply(this,e)},n.prototype.dispose=function(){var e,n,t=this._list;this._list=[],(e=t)&&(e instanceof Array||(e=[e]),n=[],e.forEach(function(t){if(t&&"function"==typeof t.dispose)try{t.dispose()}catch(e){n.push(t)}}),n.forEach(function(e){e&&"function"==typeof e.dispose&&e.dispose()}))},n);function n(){this._list=[]}e.DisposableArray=t}(Hje=Hje||{}),function(h){var n,e,t=(o.prototype.initView=function(e,t){var n=e.element(),o=typeof n;return n&&"symbol"!=o&&!0!==n?("string"==o?n=document.getElementById(n):"number"==o&&(n=document.body.children[n]),n):document.createElement(t||"div")},o.prototype.alive=function(e){if(!e||!e.parentElement)return!1;try{if(!e.parentElement.parentElement&&e!=document.body)return!1}catch(e){}return!0},o.prototype.unmount=function(e){e&&(e.innerHTML=null,e.remove())},o.prototype.append=function(e,t){e&&t&&e.appendChild(t)},o.prototype.setAttr=function(e,t,n){e.element().setAttribute(t,n)},o.prototype.setStyle=function(e,t,n){var o=e.element();o&&(Object.keys(t).forEach(function(e){o.style[e]=t[e]}),o.className=n.join(" "))},o.prototype.setTextValue=function(e,t){var n=e.element();n&&("input"!==n.tagName?n.appendChild(new Text(t)):n.value=t)},o.prototype.bindAttr=function(e,o){o.reg("value",function(t){var n=e.element();n&&o.on("change",function(e){t(n.value)})})},o.prototype.onInit=function(e){},o.prototype.on=function(e,t,n){var o=e.element();o&&(o.addEventListener?o.addEventListener(t,n,!1):o.attachEvent&&o.attachEvent("on"+t,n))},o);function o(){this.defaultTagName="div"}function v(){return e=e||new t}function m(e){var t;if(0<arguments.length&&(e?void((t=e)&&"function"==typeof t.initView&&("function"!=typeof t.alive&&(t.alive=function(e){return null!==e}),"function"!=typeof t.append&&(t.append=function(e,t){}),"function"!=typeof t.on&&(t.on=function(e,t,n){}),"function"!=typeof t.onInit&&(t.onInit=function(e){}),"function"!=typeof t.setAttr&&(t.setAttr=function(e,t,n){}),"function"!=typeof t.setStyle&&(t.setStyle=function(e,t,n){}),"function"!=typeof t.setTextValue&&(t.setTextValue=function(e,t){}),"function"!=typeof t.unmount&&(t.unmount=function(e){e&&"function"==typeof e.dispose&&e.dispose()})))&&(n=e):n=void 0),!n)try{window.document&&(n=v())}catch(e){}return n}function b(e){return e&&"function"==typeof e.subscribe}h.HtmlGenerator=t,h.viewGenerator=m,h.render=function e(t,f,n){var u,o;if(3<arguments.length&&arguments[3]&&"function"==typeof(o=arguments[3]).initView&&"function"==typeof o.alive&&(u=o),u=u||m(),f&&u){n?"string"==typeof n&&("html"===n.toLowerCase()&&(u=v()),n={}):n={};var i=n.appendMode,r=n.keyRefs&&"object"==typeof n.keyRefs,c=f.key;c&&"string"==typeof c||(c=void 0);var s={element:i?void 0:t,info:{},keyRefs:r?n.keyRefs:{}},p=new h.DisposableArray,a={element:function(){return s.element},model:function(){return f},pushDisposable:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return p.push.apply(p,e)},removeDisposable:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return p.remove.apply(p,e)},info:function(e,t){return 1<arguments.length&&(void 0===t?delete s.info[e]:s.info[e]=t),s.info[e]},childContext:function(e){return e&&"string"==typeof e?s.keyRefs[e]:void 0},alive:d};if(a.info.contain=function(e){return 0<=Object.keys(s.info).indexOf(e)},a.info.keys=function(){return Object.keys(s.info)},a.childContext.contain=function(e){return 0<=Object.keys(s.keyRefs).indexOf(e)},a.childContext.keys=function(){return Object.keys(s.keyRefs)},a.childContext.remove=function(e){return delete s.keyRefs[e]},s.element=u.initView(a,f.tagName),s.element){var l=f.attr||{},y=[];return f.attr&&"object"==typeof f.attr&&Object.keys(l).forEach(function(t){var e,n;t&&"string"==typeof t&&((e=l[t])&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e&&"symbol"!=typeof e?b(e)&&(y.push(t),n=e.subscribe(function(e){d()&&u.setAttr(a,t,e)}),a.pushDisposable(n)):u.setAttr(a,t,e))}),u.setStyle(a,f.style||{},f.styleRefs||[]),f.on&&"object"==typeof f.on&&Object.keys(f.on).forEach(function(e){var t=f.on[e];if(t)if("function"==typeof t.process){var n=t.process;if(t.options)try{var o,i,r=h.InternalInjectionPool.hittask();r&&((o=new r).setOptions(t.options),i=n,o.pushHandler(function(){return i.call}),n=o.process)}catch(e){}u.on(a,e,function(e){n.call(t.thisArg,e,a)})}else"function"==typeof t&&u.on(a,e,t)}),0<y.length&&u.bindAttr&&u.bindAttr(a,{keys:function(){return y},length:function(){return y.length},get:function(e){return l[e]},reg:function(n,e){"function"==typeof e&&e(function(e){var t=l[n];if(!b(t))return l[n]=t,!1;if("function"==typeof t.set)t.set(e);else if("function"==typeof t.next)t.next(e);else{if("function"!=typeof t)return!1;t(e)}return!0})},contain:function(e){return 0<=Object.keys(l).indexOf(e)},on:function(e,t){u.on(a,e,t)}}),i&&u.append(t,s.element),u.onInit(a),"function"==typeof n.onInit&&n.onInit(a),"function"==typeof f.onInit&&f.onInit(a),f.children&&(f.children instanceof Array?f.children.forEach(function(n){n&&e(void 0,n,{onInit:function(e){var t=e.element();t&&(u.append(s.element,t),n.key&&"string"==typeof n.key&&(s.keyRefs[n.key]=e))},keyRefs:s.keyRefs})}):"string"==typeof f.children&&u.setTextValue(a,f.children)),"function"==typeof f.onLoad&&f.onLoad(a),"function"==typeof n.onLoad&&n.onLoad(a),a.element()}}function d(){var e=s.element;return!(!e||!u.alive(e)&&(delete s.element,s.info={},r?c&&delete s.keyRefs[c]:s.keyRefs={},u.unmount(e),p.dispose(),1))}}}(Hje=Hje||{}),"function"==typeof define?!define.amd&&"undefined"==typeof __webpack_require__||define(["exports"],function(e){return Hje}):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module&&(module.exports=Hje);